name: OPA Workflow

on: pull_request

permissions:
  contents: write
  id-token: write
  issues: write
  pull-requests: write

jobs:
  policy-check:
    name: Policy check
    runs-on: ubuntu-latest
    steps:
      - name: Code checkout
        uses: actions/checkout@v3
        with:
          ref: ${{ github.event.pull_request.head.ref }}
      - name: conftest
        uses: YubicoLabs/action-conftest@v3
        with:
          files: OPA/groups.yaml
          gh-token: ${{ secrets.GITHUB_TOKEN }}
          gh-comment-url: ${{ github.event.pull_request.comments_url }}