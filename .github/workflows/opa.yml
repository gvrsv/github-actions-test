name: OPA Workflow

on: pull_request

permissions:
  contents: write
  id-token: write
  issues: write
  pull-requests: write

jobs:
  policy-check:
    name: Policy check
    runs-on: ubuntu-latest
    container: openpolicyagent/conftest:v0.32.1
    steps:
      - name: Code checkout
        uses: actions/checkout@v3
        with:
          ref: ${{ github.event.pull_request.head.ref }}
      - name: Validate docker licenses
        id: summary
        run: |
          conftest test OPA/groups.yaml -n group -o json > summary.json
      - uses: actions/upload-artifact@v3
        with:
          name: summary
          path: summary.json
          if-no-files-found: error